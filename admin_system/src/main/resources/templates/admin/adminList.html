<!DOCTYPE html>
<html class="x-admin-sm" lang="zh_CN" xmlns:th="http://www.thymeleaf.org">
  
  <head>
    <meta charset="UTF-8">
    <title>管理员</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
    <link rel="stylesheet" th:href="@{/css/font.css}">
    <link rel="stylesheet" th:href="@{/css/xadmin.css}">
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <script type="text/javascript" th:src="@{/js/jquery/jquery.min.js}"></script>
    <script type="text/javascript" th:src="@{/lib/layui/layui.js}" charset="utf-8"></script>
    <script type="text/javascript" th:src="@{/js/xadmin.js}"></script>
    <script type="text/javascript" th:src="@{/js/cookie.js}"></script>
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
      <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
      <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  
  <body>
    <div class="x-nav">
      <span class="layui-breadcrumb">
        <!--<a href="">首页</a>-->
        <!--<a href="">演示</a>-->
      </span>
      <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right" href="javascript:location.replace(location.href);" title="刷新">
        <i class="layui-icon" style="line-height:30px">ဂ</i></a>
    </div>
    <div class="x-body">
      <!--<input type="text" hidden="hidden" id="stuId" th:value="${session.student.stuId}"/>-->
      <div class="layui-row">
        <form class="layui-form layui-col-md12 x-so" action="javascript:;">
            <input type="text" name="account" id="account" placeholder="请输入账号" autocomplete="off" class="layui-input">
            <button class="layui-btn"  lay-submit="" lay-filter="search"><i class="layui-icon">&#xe615;</i></button>
        </form>
      </div>

      <!--表格显示-->
      <table class="layui-hide" id="adminList" lay-filter="adminList"></table>

      <!--表格上方操作-->
      <script type="text/html" id="complain_toolbar">
        <div class="layui-btn-container">
          <button class="layui-btn layui-btn-danger layui-btn-sm" lay-event="delBatchAll"><i class="layui-icon"></i>批量删除</button>
          <!--<button class="layui-btn layui-btn-sm" lay-event="add"><i class="layui-icon"></i>添加</button>-->
        </div>
      </script>
      <!--表格下方操作-->
      <script type="text/html" id="operateTable">
        <!--<a class="layui-btn layui-btn-xs" lay-event="detail" >查看</a>-->
        <a class="layui-btn layui-btn-xs" lay-event="edit" data-toggle="modal" data-target="#editAdminInfo" >编辑</a>
        <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del" >删除</a>
      </script>
    </div>

    <!-- 编辑管理员信息 -->
    <div class="modal" id="editAdminInfo" tabindex="-1" role="dialog" aria-labelledby="editAdminInfoModal" aria-hidden="true"
         data-backdrop="static" data-keyboard="false">
      <div class="modal-dialog " style=" width: 400px">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
              &times;
            </button>
            <h4 class="modal-title" id="editAdminInfoModal">
              修改管理员信息
            </h4>
          </div>
          <div class="modal-body">
            <input type="text" hidden="hidden" id="adminId"/>
            <div class="layui-form-item">
              <label class="layui-form-label">账号:</label>
              <div class="layui-input-block">
                <input id="adminAccount" type="text" name="adminAccount" placeholder="请输入账号" class="layui-input">
              </div>
            </div>
            <div class="layui-form-item">
              <label class="layui-form-label">邮箱:</label>
              <div class="layui-input-block">
                <input id="adminEmail" type="text" name="adminEmail" placeholder="请输入邮箱" class="layui-input">
              </div>
            </div>
            <div class="layui-form-item">
              <label class="layui-form-label">密码:</label>
              <div class="layui-input-block">
                <input id="adminPwd" type="password" name="adminPwd" placeholder="请输入密码" class="layui-input">
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button id="editAdmin" type="button" class="layui-btn layui-btn-primary"
                    data-toggle="stuContentModal" data-dismiss="modal" data-target="#editAdminInfoModal">
              修改
            </button>
            <button type="button" class="layui-btn layui-btn-primary" data-dismiss="modal">
              取消
            </button>
          </div>
        </div>
      </div>
    </div>

    <script th:src="@{/js/bootstrap.min.js}"></script>
    <script th:src="@{/lib/layui/layui.js}" charset="utf-8"></script>
    <script type="text/javascript" th:inline="none">
      layui.use(['laydate', 'form', 'table'], function() {
          var form = layui.form,
              table = layui.table;

          //渲染表格
          table.render({
              elem: '#adminList',
              // where: {stuId: stuId},
              url: '/admin/findAllAdmin',
              limits: [5, 10, 20, 30, 40, 50, 60, 70, 80, 90],
              toolbar: '#complain_toolbar', //开启头部工具栏，并为其绑定左侧模板
              response: {
                  statusCode: 200, //成功的状态码，默认：0
                  statusName: 'code',// 对应 code
                  msgName: 'msg', // 对应 msg
                  countName: 'count', // 对应 count
                  dataName: 'data'  // 对应 data
              }
              , cols: [[
                  {type: 'checkbox'},
                  {field: 'admin_id', title: 'id', hide: true},    //hide:true    隐藏列
                  {field: 'admin_account', title: '账号'},
                  {field: 'admin_mail', title: '邮箱'},
                  {field: 'admin_pwd', title: '密码'},    //TODO：密码列后期会使用md5进行加密，所以此列暂时暴露
                  {field: 'admin_createdate', title: '创建时间', sort: true},
                  {fixed: 'right', title: '操作', toolbar: '#operateTable'}
              ]]
              , page: true
          });
          //搜索按钮事件
          form.on('submit(search)', function (data) {

              table.reload('adminList', {
                  where: data.field,
                  page: {
                      curr: 1 //重新从第 1 页开始
                  }
              });
          });

          //头工具栏事件
          table.on('toolbar(adminList)', function(obj){
              var checkStatus = table.checkStatus(obj.config.id);


              console.log(checkStatus.data);

              if(checkStatus.data.length==0){
                  parent.layer.msg('请先选择要删除的数据行！', {icon: 2});
                  return ;
              }


              console.log(adminIds);


              switch(obj.event){
                  case 'delBatchAll':
                      //获得选中的id
                      var adminIds = "";
                      for(var i=0;i<checkStatus.data.length;i++){
                          adminIds += checkStatus.data[i].admin_id+",";
                      }
                      parent.layer.msg('删除中...', {icon: 16,shade: 0.3,time:500});

                      var data={adminIds:adminIds};
                      $.ajax({
                          url: "/admin/deleteBatchAdmin",
                          type: "post",
                          cache: false,
                          contentType: "application/json",
                          datatype: "json",
                          data: JSON.stringify(data),
                          success: function (result) {
                              if(200==result.code){
                                  layer.alert(result.msg, {icon: 6},function () {
                                      //重新加载页面
                                      location.reload();
                                  });
                              }else{
                                  layer.msg(result.msg, {
                                      time: 2000,
                                      btn: ['返回']
                                  });
                              }
                          },
                          error: function (response) {
                              console.log("出错返回: " + response);
                              console.log("出错数据: " + JSON.stringify(response));
                          }
                      });
                      break;
                  case 'add':

                      break;

                  /*case 'getCheckData':
                      var data = checkStatus.data;
                      layer.alert(JSON.stringify(data));
                      break;
                  case 'getCheckLength':
                      var data = checkStatus.data;
                      layer.msg('选中了：'+ data.length + ' 个');
                      break;
                  case 'isAll':
                      layer.msg(checkStatus.isAll ? '全选': '未全选');
                      break;

                  //自定义头工具栏右侧图标 - 提示
                  case 'LAYTABLE_TIPS':
                      layer.alert('这是工具栏右侧自定义的一个图标按钮');
                      break;*/
              };
          });

          //监听工具条
          table.on('tool(adminList)', function (obj) {
              var data = obj.data;

              // console.log(data);

              if (obj.event === 'del') {
                  layer.confirm('真的删除该条数据吗？', function (index) {
                      // obj.del();
                      var adminId = data.admin_id;
                      //删除行数据
                      $.ajax({
                          url: "/admin/deleteAdmin",
                          type: "post",
                          cache: false,
                          contentType: "application/json",
                          datatype: "json",
                          data: adminId,
                          success: function (result) {
                              if(200==result.code){
                                  layer.alert(result.msg, {icon: 6},function () {
                                      // 获得frame索引
                                      var index = parent.layer.getFrameIndex(window.name);
                                      //关闭当前frame
                                      parent.layer.close(index);
                                      //重新加载页面
                                      parent.location.reload();
                                  });
                              }else{
                                  layer.alert(result.msg, {icon: 5},function (index) {
                                      layer.close(index);
                                  });
                              }
                          },
                          error: function (response) {
                              console.log("出错返回: " + response);
                              console.log("出错数据: " + JSON.stringify(response));
                          }
                      });
                      layer.close(index);
                  });
              } else if (obj.event === 'edit') {

                  console.log(data);

                  //参数传到模态框
                  $("#adminId").val(data.admin_id);
                  $("#adminAccount").val(data.admin_account);
                  $("#adminEmail").val(data.admin_mail);
                  $("#adminPwd").val(data.admin_pwd);

              }
          });

          //监听提交
          $("#editAdmin").click(function () {

              console.log(111);

              //传参补充
              var adminId = $("#adminId").val();
              var adminAccount = $("#adminAccount").val();
              var adminEmail =  $("#adminEmail").val();
              var adminPwd = $("#adminPwd").val();
              var data = {
                  adminId: adminId,
                  adminAccount: adminAccount,
                  adminMail: adminEmail,
                  adminPwd: adminPwd
              };

              console.log(data);
              $.ajax({
                  url: "/admin/editAdmin",
                  type: "post",
                  cache: false,
                  contentType: "application/json",
                  dataType: "json",
                  data: JSON.stringify(data),
                  success: function (result) {
                      if(200==result.code){
                          layer.alert(result.msg, {icon: 6},function () {
                              //重新加载页面
                              location.reload();
                          });
                      }else{
                          layer.msg(result.msg, {
                              time: 2000,
                              btn: ['返回']
                          });
                      }
                  },
                  error: function (response) {
                      console.log("出错返回: " + response);
                      console.log("出错数据: " + JSON.stringify(response));
                  }
              });
          });

          $("#test").click(function(){
              hello("张三");
          });

          /*用户-停用*/
          function member_stop(obj, id) {
              layer.confirm('确认要停用吗？', function (index) {

                  if ($(obj).attr('title') == '启用') {

                      //发异步把用户状态进行更改
                      $(obj).attr('title', '停用')
                      $(obj).find('i').html('&#xe62f;');

                      $(obj).parents("tr").find(".td-status").find('span').addClass('layui-btn-disabled').html('已停用');
                      layer.msg('已停用!', {icon: 5, time: 1000});

                  } else {
                      $(obj).attr('title', '启用')
                      $(obj).find('i').html('&#xe601;');

                      $(obj).parents("tr").find(".td-status").find('span').removeClass('layui-btn-disabled').html('已启用');
                      layer.msg('已启用!', {icon: 5, time: 1000});
                  }

              });
          }

          /*用户-删除*/
          function member_del(obj, id) {
              layer.confirm('确认要删除吗？', function (index) {
                  //发异步删除数据
                  $(obj).parents("tr").remove();
                  layer.msg('已删除!', {icon: 1, time: 1000});
              });
          }

          function delAll() {

              var data = tableCheck.getData();

              var checkStatus=table.checkStatus('idTest');
              console.log(checkStatus);
              layer.confirm('确认要删除吗？' + data, function (index) {
                  //捉到所有被选中的，发异步进行删除
                  layer.msg('删除成功', {icon: 1});
                  $(".layui-form-checked").not('.header').parents('tr').remove();
              });
          }

      })


    </script>
    <script>var _hmt = _hmt || []; (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?b393d153aeb26b46e9431fabaf0f6190";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();</script>
  </body>

</html>